<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Korean of the day</title>
<meta name="description" content="Tap to reveal today’s line." />
<meta property="og:title" content="Korean of the day" />
<meta property="og:description" content="Tap to reveal today’s line." />
<meta property="og:type" content="website" />

<style>
  html,body{height:100%;margin:0}
  body{
    background:#7d8fb3; /* pastel navy */
    display:grid; grid-template-rows:auto 1fr auto; place-items:center;
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Arial
  }
  header{ text-align:center; padding:8px 10px 0 }
  .title{ font-weight:700; font-size:22px; color:#0f172a; margin:0 0 2px }
  .subtitle{ font-size:13px; color:#e5e7eb; margin:0 0 4px }

  :root{ --globe: min(39vmin, 320px); } /* keep same size */

  .stage{
    width:100%; height:100%;
    display:grid; place-content:start center;
    padding-top:4.2vh; padding-inline:12px; box-sizing:border-box;
  }

  .globe-wrap{ display:flex; flex-direction:column; align-items:center; gap:10px; }

  .tap{
    font:500 13px/1 ui-sans-serif; color:#e8eefc;
    text-shadow:0 1px 2px rgba(0,0,0,.25); opacity:.95;
  }

  .globe{
    width:var(--globe); aspect-ratio:1/1; border-radius:50%;
    display:grid; place-items:center; position:relative; overflow:hidden;
    cursor:pointer; user-select:none; transition:transform .22s ease;
    box-shadow:
      0 28px 60px rgba(10,16,30,.28),
      0 3px 10px rgba(0,0,0,.18);
    background: radial-gradient(120% 120% at 35% 30%, #f8fafc 0%, #eef2ff 45%, #e2e8f0 100%);
  }
  .globe:active{ transform:scale(.985) }

  /* ===== word sphere (inside the circle) ===== */
  #word-sphere{ position:absolute; inset:0; border-radius:50%; overflow:hidden }
  #word-sphere .ws-space{ position:absolute; inset:0; transform-style:preserve-3d; perspective:1200px }
  #word-sphere .ws-word{
    position:absolute; left:50%; top:50%;
    transform-style:preserve-3d; white-space:nowrap;
    font-weight:700; letter-spacing:.3px; color:#0f172a;
    text-shadow:0 1px 2px rgba(0,0,0,.12);
    will-change:transform, opacity, filter;
  }
  #word-sphere .ws-word.ws-accent{ color:#f59e0b; }

  /* Reveal card */
  .card{
    position:fixed; left:50%; bottom:max(12px,7vh);
    transform:translateX(-50%) translateY(16px);
    width:min(92vw,760px); background:#fff; color:#111827; border-radius:16px;
    box-shadow:0 28px 70px rgba(0,0,0,.22), 0 2px 8px rgba(0,0,0,.12);
    padding:16px 16px 12px; opacity:0; pointer-events:none;
    transition:opacity .22s, transform .22s
  }
  .card.show{ opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0) }
  .quote{ font:500 19px/1.45 ui-sans-serif; margin:2px 0 6px }
  .meta{ font:400 13px/1.35 ui-sans-serif; color:#6b7280 }
  .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px }
  .btn{ font:600 13px/1; padding:9px 12px; border-radius:10px; border:0; cursor:pointer }
  .btn.copy{ background:#111827; color:#fff }
  .btn.open{ background:#f59e0b; color:#fff; display:none }
  .again{ position:fixed; left:50%; bottom:8px; transform:translateX(-50%);
          font:400 12px/1.2 ui-sans-serif; color:#e2e8f0; opacity:.95; display:none }

  @media (max-height:520px){
    .card{ position:static; transform:none; width:min(92vw,760px); margin-top:10px }
  }
</style>
</head>
<body>

<header>
  <h1 class="title">Korean of the day</h1>
  <p class="subtitle">Tap the globe to reveal today’s line.</p>
</header>

<main class="stage">
  <div class="globe-wrap">
    <button id="globe" class="globe" aria-label="Tap to reveal today’s line">
      <!-- REPLACED SVG WITH WORD SPHERE (same container, same size) -->
      <div id="word-sphere">
        <div class="ws-space" id="ws-space"></div>
      </div>
    </button>
  </div>
</main>

<!-- Reveal card -->
<div id="card" class="card" role="dialog" aria-live="polite" aria-label="오늘의 문장">
  <p id="quote" class="quote"></p>
  <div id="meta" class="meta"></div>
  <div class="actions">
    <a id="openBook" class="btn open" target="_blank" rel="noopener">Open book</a>
    <button id="copy" class="btn copy">Copy</button>
  </div>
</div>
<div id="again" class="again">Already revealed. Come back tomorrow ✨</div>

<script>
const GAS_ENDPOINT = 'https://script.google.com/macros/s/AKfycbwKejO7i3dEV3WB2KHUP1QKKJeX2bSzIGS4jZCxfeLJKwOGZEAMECXENvPH3IdT720OIw/exec'; // <- replace
const tz = 'Asia/Seoul';

function toKstYmd(dateObj=new Date()) {
  const kst = new Date(dateObj.toLocaleString('en-US', { timeZone: tz }));
  const y = kst.getFullYear();
  const m = String(kst.getMonth()+1).padStart(2,'0');
  const d = String(kst.getDate()).padStart(2,'0');
  return `${y}-${m}-${d}`;
}
function addDays(ymd, n) {
  const [y,m,d] = ymd.split('-').map(Number);
  const dt = new Date(Date.UTC(y, m-1, d));
  dt.setUTCDate(dt.getUTCDate() + n);
  const y2 = dt.getUTCFullYear();
  const m2 = String(dt.getUTCMonth()+1).padStart(2,'0');
  const d2 = String(dt.getUTCDate()).padStart(2,'0');
  return `${y2}-${m2}-${d2}`;
}
function getQueryDateOrToday() {
  const u = new URL(location.href);
  return u.searchParams.get('d') || toKstYmd();
}

async function loadQuote(ymd) {
  document.getElementById('status').textContent = '';
  document.getElementById('qText').textContent = 'Loading…';
  document.getElementById('qDate').textContent = ymd;

  try {
    const res = await fetch(`${GAS_ENDPOINT}?d=${encodeURIComponent(ymd)}`, { cache: 'no-store' });
    const data = await res.json();

    if (data.error) {
      document.getElementById('qText').textContent = 'No quote for this date yet.';
      document.getElementById('status').textContent = `(${data.error})`;
      document.getElementById('qBook').textContent = '—';
      document.getElementById('qAuthor').textContent = '';
      document.getElementById('qIsbn').textContent = '';
      document.getElementById('qLink').href = '#';
      document.getElementById('qCover').src = '';
      document.getElementById('qCover').alt = 'No cover';
      return;
    }

    document.getElementById('qBook').textContent = data.book || 'Untitled';
    document.getElementById('qAuthor').textContent = data.author ? `by ${data.author}` : '';
    document.getElementById('qIsbn').textContent = data.isbn ? `ISBN: ${data.isbn}` : '';
    document.getElementById('qText').textContent = data.text || '(no text)';
    document.getElementById('qLink').href = data.link || '#';
    document.getElementById('qCover').src = data.cover || '';
    document.getElementById('qCover').alt = data.book ? `${data.book} cover` : 'Book cover';

  } catch (err) {
    document.getElementById('qText').textContent = 'Failed to load.';
    document.getElementById('status').textContent = err.message;
  }
}

// nav buttons
let currentYmd = getQueryDateOrToday();
document.getElementById('prevBtn').addEventListener('click', () => {
  currentYmd = addDays(currentYmd, -1);
  history.replaceState(null, '', `?d=${currentYmd}`);
  loadQuote(currentYmd);
});
document.getElementById('nextBtn').addEventListener('click', () => {
  currentYmd = addDays(currentYmd, +1);
  history.replaceState(null, '', `?d=${currentYmd}`);
  loadQuote(currentYmd);
});

// initial load
loadQuote(currentYmd);
</script>
</body>
</html>
