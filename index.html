<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Korean of the day</title>
<meta name="description" content="Tap to reveal today’s line." />
<meta property="og:title" content="Korean of the day" />
<meta property="og:description" content="Tap to reveal today’s line." />
<meta property="og:type" content="website" />
<style>
  html,body{height:100%;margin:0}
  body{
    /* pastel navy */
    background:#7d8fb3;
    display:grid;grid-template-rows:1fr auto;place-items:center;
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Arial
  }
  :root{ --globe: min(78vmin, 640px); }

  .stage{
    width:100%;height:100%;display:grid;place-items:center;padding:12px;box-sizing:border-box
  }

  /* Circular “button” container */
  .globe{
    width:var(--globe);aspect-ratio:1/1;border-radius:50%;
    background: #f5f7fb; /* soft off-white to contrast navy */
    display:grid;place-items:center;position:relative;
    box-shadow:0 18px 40px rgba(0,0,0,.22), 0 2px 8px rgba(0,0,0,.12);
    cursor:pointer;user-select:none;transition:transform .26s ease
  }
  .globe:active{ transform: scale(.985); }

  /* Keep inner SVG comfortably inset */
  .globe svg{ width:86%; height:auto; display:block; }

  /* “Tap to reveal” hint */
  .tap{
    position:absolute; bottom:7.5%; left:50%; transform:translateX(-50%);
    font:500 14px/1 ui-sans-serif; color:#334155; opacity:.9
  }

  /* Reveal card */
  .card{
    position:fixed; left:50%; bottom:max(12px,7vh); transform:translateX(-50%) translateY(16px);
    width:min(92vw,760px); background:#ffffff; color:#111827; border-radius:16px;
    box-shadow:0 28px 70px rgba(0,0,0,.22), 0 2px 8px rgba(0,0,0,.12);
    padding:16px 16px 12px; opacity:0; pointer-events:none;
    transition:opacity .22s ease, transform .22s ease
  }
  .card.show{ opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(0) }
  .quote{ font:500 19px/1.45 ui-sans-serif; margin:2px 0 6px }
  .meta{ font:400 13px/1.35 ui-sans-serif; color:#6b7280 }
  .actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px }
  .btn{ font:600 13px/1; padding:9px 12px; border-radius:10px; border:0; cursor:pointer }
  .btn.copy{ background:#111827; color:#fff }
  .btn.open{ background:#f59e0b; color:#fff; display:none }
  .again{ position:fixed; left:50%; bottom:8px; transform:translateX(-50%);
          font:400 12px/1.2 ui-sans-serif; color:#e2e8f0; opacity:.95; display:none }

  @media (max-height:520px){
    .card{ position:static; transform:none; width:min(92vw,760px); margin-top:10px }
  }
</style>
</head>
<body>

<main class="stage">
  <button id="globe" class="globe" aria-label="Tap to reveal today’s line">
    <!-- HANGUL GLOBE (SVG) -->
    <svg viewBox="0 0 1000 1000" aria-hidden="true" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <!-- 5 circular paths (rings) -->
        <path id="ring1" d="M500,140 a360,360 0 1,1 -0.1,0" />
        <path id="ring2" d="M500,210 a290,290 0 1,1 -0.1,0" />
        <path id="ring3" d="M500,280 a220,220 0 1,1 -0.1,0" />
        <path id="ring4" d="M500,350 a150,150 0 1,1 -0.1,0" />
        <path id="ring5" d="M500,420 a80,80   0 1,1 -0.1,0" />
      </defs>

      <!-- Style: slightly varied opacities to look layered; navy accents -->
      <g fill="#1e293b" font-size="46" font-weight="700" letter-spacing="6">
        <text>
          <textPath href="#ring1" startOffset="0%">
            한글 · 말 · 문자 · 소리 · 가나다라 · 한국어 · 배움 · 공부 · 표현 · 한글 · 말 · 문자 · 소리 · 가나다라 · 한국어 · 배움 · 공부 · 표현
          </textPath>
        </text>
      </g>

      <g fill="#0f172a" opacity="0.85" font-size="40" font-weight="700" letter-spacing="5">
        <text>
          <textPath href="#ring2" startOffset="12%">
            자모 · 모음 · 자음 · 의미 · 읽기 · 쓰기 · 말하기 · 듣기 · 표현 · 자모 · 모음 · 자음 · 의미 · 읽기 · 쓰기 · 말하기 · 듣기
          </textPath>
        </text>
      </g>

      <g fill="#334155" opacity="0.8" font-size="34" font-weight="700" letter-spacing="4">
        <text>
          <textPath href="#ring3" startOffset="25%">
            배움 · 어휘 · 문장 · 문법 · 예문 · 발음 · 리듬 · 억양 · 배움 · 어휘 · 문장 · 문법 · 예문 · 발음 · 리듬 · 억양
          </textPath>
        </text>
      </g>

      <g fill="#475569" opacity="0.75" font-size="28" font-weight="700" letter-spacing="3">
        <text>
          <textPath href="#ring4" startOffset="40%">
            오늘 · 문장 · 한 줄 · 배움 · 오늘 · 문장 · 한 줄 · 배움 · 오늘 · 문장 · 한 줄 · 배움
          </textPath>
        </text>
      </g>

      <g fill="#64748b" opacity="0.7" font-size="22" font-weight="700" letter-spacing="2">
        <text>
          <textPath href="#ring5" startOffset="55%">
            한 · 글 · 말 · 뜻 · 음 · 훈 · 한 · 글 · 말 · 뜻 · 음 · 훈
          </textPath>
        </text>
      </g>
    </svg>

    <div class="tap">Tap to reveal</div>
  </button>
</main>

<!-- Reveal card -->
<div id="card" class="card" role="dialog" aria-live="polite" aria-label="오늘의 문장">
  <p id="quote" class="quote"></p>
  <div id="meta" class="meta"></div>
  <div class="actions">
    <a id="openBook" class="btn open" target="_blank" rel="noopener">Open book</a>
    <button id="copy" class="btn copy">Copy</button>
  </div>
</div>
<div id="again" class="again">Already revealed. Come back tomorrow ✨</div>

<script>
  // 👇 Replace with your deployed Apps Script Web App URL
  const GAS_ENDPOINT = 'https://script.google.com/macros/s/REPLACE_WITH_YOURS/exec';

  // Analytics helpers
  const params = new URLSearchParams(location.search);
  const SRC = params.get('utm_source') || '';
  const today = new Date();
  const ymd = today.toISOString().slice(0,10);
  const UID_KEY = 'fortune-uid';
  let uid = localStorage.getItem(UID_KEY);
  if(!uid){ uid = Math.random().toString(36).slice(2) + Date.now().toString(36); localStorage.setItem(UID_KEY, uid); }

  const globe   = document.getElementById('globe');
  const card    = document.getElementById('card');
  const quoteEl = document.getElementById('quote');
  const metaEl  = document.getElementById('meta');
  const openBook= document.getElementById('openBook');
  const copyBtn = document.getElementById('copy');
  const again   = document.getElementById('again');

  async function logEvent(event, note=''){
    try {
      await fetch(GAS_ENDPOINT + '?fn=log', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({event, ymd, uid, ua:navigator.userAgent, ref:document.referrer||'', src:SRC, note})
      });
    } catch(_) {}
  }
  logEvent('view');

  async function getQuote(){
    const r = await fetch(GAS_ENDPOINT + '?fn=quote&d=' + ymd, { cache:'no-store' });
    if(!r.ok) throw new Error('network');
    return await r.json();
  }

  let opened = false;
  globe.addEventListener('click', async () => {
    if(opened) return;
    opened = true;
    logEvent('reveal');

    try {
      const q = await getQuote();
      quoteEl.textContent = '“' + q.text + '”';
      const bits = [];
      if(q.book)  bits.push('<span style="font-weight:600">' + q.book + '</span>');
      if(q.author)bits.push(q.author);
      if(q.isbn)  bits.push('ISBN ' + q.isbn);
      metaEl.innerHTML = bits.join(' · ');
      if(q.link){ openBook.href = q.link; openBook.style.display = 'inline-block'; }
    } catch(e){
      quoteEl.textContent = '잠시 후 다시 시도해 주세요.';
    }

    card.classList.add('show');
    setTimeout(()=> { again.style.display='block'; }, 80);
  });

  copyBtn.addEventListener('click', async () => {
    const txt = quoteEl.textContent + (metaEl.textContent ? ('\n— ' + metaEl.textContent) : '');
    try {
      await navigator.clipboard.writeText(txt);
      const old = copyBtn.textContent; copyBtn.textContent = 'Copied!';
      setTimeout(()=> copyBtn.textContent = old, 1400);
    } catch(_) {}
  });
</script>
</body>
</html>
